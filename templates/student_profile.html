<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Profile</title>
    <!-- Base Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/form.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

    <main class="main-content">

        <div class="container">
            <div class="form-header">
                <h2 class="form-title">Student Profile</h2>
                <p class="section-subtitle">Update your personal and academic information</p>
            </div>

            <!-- Flash messages -->
            <div class="flash-messages">
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{category}}">
                    {{ message }}
                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}
            </div>
            <form action="/student_profile" method="POST" class="form-container">
                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-user"></i>
                        Personal Information
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="studentName" class="form-label">Student's Name</label>
                            <input type="text" id="studentName" name="studentName"
                                value="{{ form_data.student_name or '' }}" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="fatherName" class="form-label">Father's Name</label>
                            <input type="text" id="fatherName" name="fatherName" value="{{form_data.father_name or ''}}"
                                class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="motherName" class="form-label">Mother's Name</label>
                            <input type="text" id="motherName" name="motherName" value="{{form_data.mother_name or ''}}"
                                class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="dob" class="form-label">Date of Birth</label>
                            <input type="date" id="dob" name="dob" value="{{form_data.dob or ''}}" class="form-control"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="gender" class="form-label">Gender</label>
                            <select id="gender" name="gender" class="form-control form-select" required>
                                <option value="">Select Gender</option>
                                <option value="Male" {% if form_data.gender=='Male' %}selected{% endif %}>Male
                                </option>
                                <option value="Female" {% if form_data.gender=='Female' %}selected{% endif %}>Female
                                </option>
                                <option value="Other" {% if form_data.gender=='Other' %}selected{% endif %}>Other
                                </option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="religion" class="form-label">Religion</label>
                            <select id="religion" name="religion" class="form-control form-select" required>
                                <option value="">Select Religion</option>
                                <option value="Hindu" {% if form_data.religion=='Hindu' %}selected{% endif %}>Hindu
                                </option>
                                <option value="Muslim" {% if form_data.religion=='Muslim' %}selected{% endif %}>Muslim
                                </option>
                                <option value="Christian" {% if form_data.religion=='Christian' %}selected{% endif %}>
                                    Christian</option>
                                <option value="Sikh" {% if form_data.religion=='Sikh' %}selected{% endif %}>Sikh
                                </option>
                                <option value="Jain" {% if form_data.religion=='Jain' %}selected{% endif %}>Jain
                                </option>
                                <option value="Buddhist" {% if form_data.religion=='Buddhist' %}selected{% endif %}>
                                    Buddhist</option>
                                <option value="Other" {% if form_data.religion=='Other' %}selected{% endif %}>Other
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="category" class="form-label">Category</label>
                            <select id="category" name="category" class="form-control form-select" required>
                                <option value="">Select Category</option>
                                <option value="General" {% if form_data.category=='General' %}selected{% endif %}>
                                    General
                                </option>
                                <option value="OBC" {% if form_data.category=='OBC' %}selected{% endif %}>OBC</option>
                                <option value="SC" {% if form_data.category=='SC' %}selected{% endif %}>SC</option>
                                <option value="ST" {% if form_data.category=='ST' %}selected{% endif %}>ST</option>
                                <option value="Other" {% if form_data.category=='Other' %}selected{% endif %}>Other
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="aadhar" class="form-label">Aadhar Number</label>
                            <input type="text" id="aadhar" name="aadhar" value="{{ form_data.aadhar or '' }}"
                                class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="mobile" class="form-label">Mobile Number</label>
                            <input type="tel" id="mobile" name="mobile" value="{{ form_data.mobile or '' }}"
                                class="form-control" required>
                        </div>
                    </div>
                </div>

                <!-- Academic Information Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        Academic Information
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="canId" class="form-label">CAN ID</label>
                            <input type="text" id="canId" name="canId" value="{{ form_data.can_id or '' }}"
                                class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label for="district" class="form-label">District</label>
                            <select id="district" name="district" class="form-control form-select" required>
                                <option value="">Select District</option>
                                <option value="Bilaspur" {% if form_data.district=='Bilaspur' %}selected{% endif %}>
                                    Bilaspur
                                </option>
                                <option value="Chamba" {% if form_data.district=='Chamba' %}selected{% endif %}>Chamba
                                </option>
                                <option value="Hamirpur" {% if form_data.district=='Hamirpur' %}selected{% endif %}>
                                    Hamirpur
                                </option>
                                <option value="Kangra" {% if form_data.district=='Kangra' %}selected{% endif %}>Kangra
                                </option>
                                <option value="Kullu" {% if form_data.district=='Kullu' %}selected{% endif %}>Kullu
                                </option>
                                <option value="Mandi" {% if form_data.district=='Mandi' %}selected{% endif %}>Mandi
                                </option>
                                <option value="Sirmour" {% if form_data.district=='Sirmour' %}selected{% endif %}>
                                    Sirmour
                                </option>
                                <option value="Solan" {% if form_data.district=='Solan' %}selected{% endif %}>Solan
                                </option>
                                <option value="Una" {% if form_data.district=='Una' %}selected{% endif %}>Una</option>
                            </select>
                        </div>

                        <!-- Center Selection -->
                        <div class="form-group">
                            <label for="center" class="form-label">Center/Block</label>
                            <select id="center" name="center" class="form-control form-select" required>
                                <option value="">Select Center/Block</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="trade" class="form-label">Trade</label>
                            <select id="trade" name="trade" class="form-control form-select" required>
                                <option value="">Select Trade</option>
                                <option value="Agriculture" {% if form_data.trade=='Agriculture' %}selected{% endif %}>
                                    Agriculture</option>
                                <option value="Beauty & Wellness" {% if form_data.trade=='Beauty & Wellness'
                                    %}selected{% endif %}>
                                    Beauty&nbsp&&nbspWellness
                                </option>
                                <option value="Plumbing" {% if form_data.trade=='Plumbing' %}selected{% endif %}>
                                    Plumbing
                                </option>
                                <option value="Food Processing" {% if form_data.trade=='Food&nbspProcessing'
                                    %}selected{% endif %}>Food Processing
                                </option>
                                <option value="Automotive" {% if form_data.trade=='Automotive' %}selected{% endif %}>
                                    Automotive</option>
                                <option value="Electronics" {% if form_data.trade=='Electronics' %}selected{% endif %}>
                                    Electronics</option>
                                <option value="Tourism & Hospitality" {% if
                                    form_data.trade=='Tourism&nbsp&&nbspHospitality' %}selected{% endif %}>
                                    Tourism&nbsp&&nbspHospitality</option>
                                <option value="ITeS" {% if form_data.trade=='ITeS' %}selected{% endif %}>ITeS</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Bank Details Section -->
                <div class="form-section">
                    <h3 class="section-title">
                        <i class="fas fa-university"></i>
                        Bank Details
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="accountNumber" class="form-label">Bank Account Number</label>
                            <input type="text" id="accountNumber" name="accountNumber"
                                value="{{ form_data.account_number or '' }}" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="accountHolder" class="form-label">Account Holder Name</label>
                            <input type="text" id="accountHolder" name="accountHolder"
                                value="{{ form_data.account_holder or '' }}" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="ifsc" class="form-label">Bank IFSC Code</label>
                            <input type="text" id="ifsc" name="ifsc" value="{{ form_data.ifsc or '' }}"
                                class="form-control" required>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="form-actions">
                    <a href="{{ url_for('reset_password') }}" class="btn-outline btn-link">Reset Password</a>
                    <button type="submit" class="btn btn-primary">Complete Profile</button>
                </div>
            </form>
        </div>
    </main>

    <script>
        // Center data for each district (consistent with signup form)
        const centerData = {
            "Bilaspur": ["Jhandutta", "Sadar", "Shri Naina Devi Ji"],
            "Chamba": ["Banikhet", "Chamba", "Chowari", "Garola", "Gehra", "Hardaspura", "Kalhel", "Kiani", "Mehla",
                "Salooni", "Sihunta", "Sundla", "Tissa"
            ],
            "Hamirpur": ["Hamirpur"],
            "Kangra": ["Baijnath", "Nurpur", "Panchrukhi", "Rait"],
            "Kullu": ["Anni", "Banjar", "Kullu-1", "Kullu-2", "Naggar", "Nirmand"],
            "Mandi": ["Sadar-2", "Seraj-2"],
            "Sirmour": ["Bakras", "Dadahu", "Narag", "Paonta Sahib", "Rajgarh", "Sataun", "Shillai", "Surla",
                "Majra"
            ],
            "Solan": ["Arki", "Dharampur", "Dhandun", "Kandaghat", "Nalagarh", "Rameshwar"],
            "Una": ["Amb", "Gagret-1", "Haroli", "Jol", "Una"]
        };

        // Function to update centers based on selected district
        function updateCenters() {
            const districtSelect = document.getElementById('district');
            const centerSelect = document.getElementById('center');
            const selectedDistrict = districtSelect.value;
            const currentCenter = "{{ form_data.center if form_data.center else '' }}";

            // Clear existing options
            centerSelect.innerHTML = '<option value="">Select Center</option>';

            if (selectedDistrict && centerData[selectedDistrict]) {
                centerSelect.disabled = false;

                // Add new options
                centerData[selectedDistrict].forEach(center => {
                    const option = document.createElement('option');
                    // Use the actual center name as both value and display text
                    option.value = center;
                    option.textContent = center;

                    // Preserve selected center if it matches
                    if (center === currentCenter) {
                        option.selected = true;
                    }

                    centerSelect.appendChild(option);
                });
            } else {
                centerSelect.disabled = true;
            }
        }

        // Initialize the form when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            // Add event listener for district change
            document.getElementById('district').addEventListener('change', updateCenters);

            // Initialize centers based on current district selection
            updateCenters();

            // If there's a form error and district was selected, make sure centers are properly populated
            const districtValue = "{{ form_data.district if form_data.district else '' }}";
            if (districtValue) {
                updateCenters();
            }
        });

        document.querySelector('.mobile-toggle').addEventListener('click', function () {
            document.querySelector('.nav-links').classList.toggle('active');
        });


        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.classList.add('fade-out');
                setTimeout(() => alert.remove(), 500);
            });
        }, 3000);
    </script>
</body>

</html>